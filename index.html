<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <title>ìº í•‘ ìŠ¤ì¼€ì¤„</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        * { -webkit-tap-highlight-color: transparent; }
        body { overscroll-behavior: none; }
        @keyframes spin { to { transform: rotate(360deg); } }
        .animate-spin { animation: spin 1s linear infinite; }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
        .animate-fade { animation: fadeIn 0.5s ease-in; }
    </style>
</head>
<body class="bg-gray-50">
    <div id="app"></div>

    <script src="https://unpkg.com/firebase@8.10.1/firebase-app.js"></script>
    <script src="https://unpkg.com/firebase@8.10.1/firebase-firestore.js"></script>
    
    <script>
        setTimeout(function() {
            if (typeof firebase === 'undefined') {
                document.getElementById('app').innerHTML = '<div class="p-4 text-center text-red-600">Firebase ë¡œë“œ ì‹¤íŒ¨</div>';
                return;
            }
            
            const firebaseConfig = {
                apiKey: "AIzaSyAu15qibhSy3rBEUYXOxRCqoBf-BlpLtJg",
                authDomain: "camp-4cd5d.firebaseapp.com",
                projectId: "camp-4cd5d",
                storageBucket: "camp-4cd5d.firebasestorage.app",
                messagingSenderId: "322221151055",
                appId: "1:322221151055:web:bf81c9f9310b4daf4f6b3a"
            };

            firebase.initializeApp(firebaseConfig);
            const db = firebase.firestore();

            let schedules = [];
            let campings = [];
            let notes = [];
            let users = [];
            let currentUser = null;
            let selectedDate = null;
            let showModal = false;
            let showAuthModal = false;
            let showCampingModal = false;
            let showDetailPage = false;
            let authMode = 'login';
            let editingCamping = null;
            let showLoading = false;

            const familyColors = {
                0: '#3b82f6',
                1: '#ef4444',
                2: '#10b981'
            };

            const savedUser = localStorage.getItem('campingUser');
            if (savedUser) {
                currentUser = JSON.parse(savedUser);
                showLoading = true;
            }

            db.collection('users').onSnapshot(function(snapshot) {
                users = [];
                snapshot.forEach(function(doc) {
                    users.push({ id: doc.id, ...doc.data() });
                });
                render();
            });

            db.collection('schedules').onSnapshot(function(snapshot) {
                schedules = [];
                snapshot.forEach(function(doc) {
                    schedules.push({ id: doc.id, ...doc.data() });
                });
                render();
            });

            db.collection('campings').onSnapshot(function(snapshot) {
                campings = [];
                snapshot.forEach(function(doc) {
                    campings.push({ id: doc.id, ...doc.data() });
                });
                render();
            });

            db.collection('notes').onSnapshot(function(snapshot) {
                notes = [];
                snapshot.forEach(function(doc) {
                    notes.push({ id: doc.id, ...doc.data() });
                });
                render();
            });

            // ë¡œë”© í™”ë©´ íƒ€ì´ë¨¸
            if (showLoading) {
                setTimeout(function() {
                    showLoading = false;
                    render();
                }, 2000);
            }

            function getNext30Days() {
                const dates = [];
                const today = new Date();
                for (let i = 0; i < 30; i++) {
                    const date = new Date(today);
                    date.setDate(today.getDate() + i);
                    dates.push(date);
                }
                return dates;
            }

            function formatDate(date) {
                return date.getFullYear() + '-' + 
                       String(date.getMonth() + 1).padStart(2, '0') + '-' + 
                       String(date.getDate()).padStart(2, '0');
            }

            function formatDateKo(date) {
                const days = ['ì¼', 'ì›”', 'í™”', 'ìˆ˜', 'ëª©', 'ê¸ˆ', 'í† '];
                return (date.getMonth() + 1) + '/' + date.getDate() + ' (' + days[date.getDay()] + ')';
            }

            function getDateColor(date) {
                const day = date.getDay();
                if (day === 0) return 'text-red-600';
                if (day === 6) return 'text-blue-600';
                return 'text-gray-800';
            }

            function getSchedulesForDate(dateStr) {
                return schedules.filter(function(s) { return s.date === dateStr; });
            }

            function getCampingForDate(dateStr) {
                for (let i = 0; i < campings.length; i++) {
                    if (campings[i].date === dateStr) return campings[i];
                }
                return null;
            }

            function getNotesForDate(dateStr) {
                return notes.filter(function(n) { return n.date === dateStr; });
            }

            function getUserSchedule(dateSchedules, userId) {
                for (let i = 0; i < dateSchedules.length; i++) {
                    if (dateSchedules[i].userId === userId) {
                        return dateSchedules[i];
                    }
                }
                return null;
            }

            window.openAuthModal = function(mode) {
                authMode = mode;
                showAuthModal = true;
                document.body.style.overflow = 'hidden';
                render();
            };

            window.closeAuthModal = function() {
                showAuthModal = false;
                document.body.style.overflow = 'auto';
                render();
            };

            window.handleSignup = function() {
                const name = document.getElementById('signupName').value.trim();
                const phone = document.getElementById('signupPhone').value.trim();

                if (!name || !phone) {
                    alert('ê°€ì¡±ëª…ê³¼ ì „í™”ë²ˆí˜¸ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.');
                    return;
                }

                let isDuplicate = false;
                for (let i = 0; i < users.length; i++) {
                    if (users[i].phone === phone) {
                        isDuplicate = true;
                        break;
                    }
                }

                if (isDuplicate) {
                    alert('ì´ë¯¸ ê°€ì…ëœ ì „í™”ë²ˆí˜¸ì…ë‹ˆë‹¤.');
                    return;
                }

                if (users.length >= 3) {
                    alert('ì •ì›ì´ ë§ˆê°ë˜ì—ˆìŠµë‹ˆë‹¤. (ìµœëŒ€ 3ê°€ì¡±)');
                    return;
                }

                const userData = {
                    name: name,
                    phone: phone,
                    colorIndex: users.length,
                    createdAt: new Date().toISOString()
                };

                db.collection('users').add(userData)
                    .then(function(docRef) {
                        currentUser = { id: docRef.id, ...userData };
                        localStorage.setItem('campingUser', JSON.stringify(currentUser));
                        showLoading = true;
                        closeAuthModal();
                        render();
                        setTimeout(function() {
                            showLoading = false;
                            render();
                        }, 2000);
                    })
                    .catch(function(error) {
                        alert('ê°€ì… ì‹¤íŒ¨: ' + error.message);
                    });
            };

            window.handleLogin = function() {
                const name = document.getElementById('loginName').value.trim();
                const phone = document.getElementById('loginPhone').value.trim();

                if (!name || !phone) {
                    alert('ê°€ì¡±ëª…ê³¼ ì „í™”ë²ˆí˜¸ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.');
                    return;
                }

                let foundUser = null;
                for (let i = 0; i < users.length; i++) {
                    if (users[i].name === name && users[i].phone === phone) {
                        foundUser = users[i];
                        break;
                    }
                }

                if (foundUser) {
                    currentUser = foundUser;
                    localStorage.setItem('campingUser', JSON.stringify(currentUser));
                    showLoading = true;
                    closeAuthModal();
                    render();
                    setTimeout(function() {
                        showLoading = false;
                        render();
                    }, 2000);
                } else {
                    alert('ì¼ì¹˜í•˜ëŠ” íšŒì› ì •ë³´ê°€ ì—†ìŠµë‹ˆë‹¤.');
                }
            };

            window.logout = function() {
                if (confirm('ë¡œê·¸ì•„ì›ƒ í•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
                    currentUser = null;
                    localStorage.removeItem('campingUser');
                    render();
                }
            };

            window.openAddModal = function(dateStr) {
                if (!currentUser) {
                    alert('ë¡œê·¸ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤.');
                    openAuthModal('login');
                    return;
                }
                selectedDate = dateStr;
                showModal = true;
                document.body.style.overflow = 'hidden';
                render();
            };

            window.closeModal = function() {
                showModal = false;
                selectedDate = null;
                document.body.style.overflow = 'auto';
                render();
            };

            window.openCampingModal = function(dateStr, camping) {
                if (!currentUser) {
                    alert('ë¡œê·¸ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤.');
                    return;
                }
                selectedDate = dateStr;
                editingCamping = camping || null;
                showCampingModal = true;
                document.body.style.overflow = 'hidden';
                render();
            };

            window.closeCampingModal = function() {
                showCampingModal = false;
                editingCamping = null;
                document.body.style.overflow = 'auto';
                render();
            };

            window.saveCamping = function() {
                const name = document.getElementById('campingName').value.trim();
                const address = document.getElementById('campingAddress').value.trim();
                const website = document.getElementById('campingWebsite').value.trim();

                if (!name) {
                    alert('ìº í•‘ì¥ ì´ë¦„ì€ í•„ìˆ˜ì…ë‹ˆë‹¤.');
                    return;
                }

                const campingData = {
                    date: selectedDate,
                    name: name,
                    address: address,
                    website: website,
                    createdBy: currentUser.id,
                    createdByName: currentUser.name
                };

                if (editingCamping) {
                    if (editingCamping.createdBy !== currentUser.id) {
                        alert('ë³¸ì¸ì´ ë“±ë¡í•œ ìº í•‘ì¥ë§Œ ìˆ˜ì •í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.');
                        return;
                    }
                    db.collection('campings').doc(editingCamping.id).update(campingData)
                        .then(function() { closeCampingModal(); });
                } else {
                    db.collection('campings').add(campingData)
                        .then(function() { closeCampingModal(); });
                }
            };

            window.setStatus = function(status) {
                if (!currentUser || !selectedDate) return;

                let existingSchedule = null;
                for (let i = 0; i < schedules.length; i++) {
                    if (schedules[i].date === selectedDate && schedules[i].userId === currentUser.id) {
                        existingSchedule = schedules[i];
                        break;
                    }
                }

                const scheduleData = {
                    title: status,
                    date: selectedDate,
                    userId: currentUser.id,
                    userName: currentUser.name,
                    color: familyColors[currentUser.colorIndex]
                };

                if (existingSchedule) {
                    db.collection('schedules').doc(existingSchedule.id).update(scheduleData)
                        .then(function() { closeModal(); });
                } else {
                    db.collection('schedules').add(scheduleData)
                        .then(function() { closeModal(); });
                }
            };

            window.deleteStatus = function(scheduleId) {
                if (confirm('ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
                    db.collection('schedules').doc(scheduleId).delete();
                }
            };

            window.openDetailPage = function(dateStr) {
                selectedDate = dateStr;
                showDetailPage = true;
                document.body.style.overflow = 'hidden';
                render();
            };

            window.closeDetailPage = function() {
                showDetailPage = false;
                selectedDate = null;
                document.body.style.overflow = 'auto';
                render();
            };

            window.addNote = function(userId) {
                const input = document.getElementById('noteInput-' + userId);
                const content = input.value.trim();

                if (!content) return;

                const noteData = {
                    date: selectedDate,
                    userId: userId,
                    content: content,
                    createdAt: new Date().toISOString()
                };

                db.collection('notes').add(noteData)
                    .then(function() {
                        input.value = '';
                    });
            };

            window.deleteNote = function(noteId, noteUserId) {
                if (noteUserId !== currentUser.id) {
                    alert('ë³¸ì¸ì´ ì‘ì„±í•œ ë©”ëª¨ë§Œ ì‚­ì œí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.');
                    return;
                }
                if (confirm('ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
                    db.collection('notes').doc(noteId).delete();
                }
            };

            function render() {
                const app = document.getElementById('app');

                // ë¡œë”© í™”ë©´
                if (showLoading) {
                    app.innerHTML = `
                        <div class="fixed inset-0 bg-gradient-to-b from-blue-400 to-green-400 flex flex-col items-center justify-center">
                            <div class="animate-fade">
                                <div class="text-6xl mb-4">ğŸ•ï¸</div>
                                <div class="text-6xl mb-8">ğŸ”¥</div>
                                <h2 class="text-2xl font-bold text-white mb-4">ìº í•‘ ìŠ¤ì¼€ì¤„</h2>
                                <div class="flex gap-2">
                                    <div class="w-3 h-3 bg-white rounded-full animate-bounce" style="animation-delay: 0s"></div>
                                    <div class="w-3 h-3 bg-white rounded-full animate-bounce" style="animation-delay: 0.2s"></div>
                                    <div class="w-3 h-3 bg-white rounded-full animate-bounce" style="animation-delay: 0.4s"></div>
                                </div>
                            </div>
                        </div>
                    `;
                    return;
                }
                
                // ë¡œê·¸ì¸ ì•ˆ ëœ ê²½ìš°
                if (!currentUser) {
                    app.innerHTML = `
                        <div class="min-h-screen flex flex-col items-center justify-center p-6 bg-gradient-to-b from-green-400 to-blue-400">
                            <div class="text-center mb-8">
                                <h1 class="text-6xl mb-4">ğŸ•ï¸</h1>
                                <h2 class="text-3xl font-bold text-white mb-2">ìº í•‘ ìŠ¤ì¼€ì¤„</h2>
                                <p class="text-white/90">ê°€ì¡±ë“¤ê³¼ ìº í•‘ ì¼ì •ì„ ê³µìœ í•˜ì„¸ìš”</p>
                            </div>
                            <div class="w-full max-w-sm space-y-3">
                                <button onclick="openAuthModal('login')" class="w-full py-4 bg-white text-green-700 rounded-lg font-bold text-lg active:bg-gray-100 shadow-lg">
                                    ë¡œê·¸ì¸
                                </button>
                                <button onclick="openAuthModal('signup')" class="w-full py-4 bg-green-600 text-white rounded-lg font-bold text-lg active:bg-green-700 shadow-lg">
                                    íšŒì›ê°€ì…
                                </button>
                            </div>
                            <div class="mt-8 text-sm text-white text-center">
                                <p>í˜„ì¬ ê°€ì¡±: ${users.length}/3</p>
                            </div>
                        </div>

                        ${showAuthModal ? `
                            <div class="fixed inset-0 bg-black/50 z-50 flex items-center justify-center p-4" onclick="if(event.target === this) closeAuthModal()">
                                <div class="bg-white w-full max-w-sm rounded-2xl p-6">
                                    <h3 class="text-2xl font-bold mb-6 text-center">${authMode === 'login' ? 'ë¡œê·¸ì¸' : 'íšŒì›ê°€ì…'}</h3>
                                    ${authMode === 'signup' ? `
                                        <div class="space-y-4">
                                            <div>
                                                <label class="block text-sm font-medium text-gray-700 mb-1">ê°€ì¡±ëª…</label>
                                                <input type="text" id="signupName" placeholder="ê¹€ì”¨ë„¤ ê°€ì¡±" class="w-full px-4 py-3 border border-gray-300 rounded-lg text-base">
                                            </div>
                                            <div>
                                                <label class="block text-sm font-medium text-gray-700 mb-1">ì „í™”ë²ˆí˜¸</label>
                                                <input type="tel" id="signupPhone" placeholder="01012345678" class="w-full px-4 py-3 border border-gray-300 rounded-lg text-base">
                                            </div>
                                            <button onclick="handleSignup()" class="w-full py-3 bg-green-600 text-white rounded-lg font-bold active:bg-green-700">
                                                ê°€ì…í•˜ê¸°
                                            </button>
                                            <button onclick="openAuthModal('login')" class="w-full py-3 border border-gray-300 text-gray-700 rounded-lg active:bg-gray-50">
                                                ë¡œê·¸ì¸ìœ¼ë¡œ ì „í™˜
                                            </button>
                                        </div>
                                    ` : `
                                        <div class="space-y-4">
                                            <div>
                                                <label class="block text-sm font-medium text-gray-700 mb-1">ê°€ì¡±ëª…</label>
                                                <input type="text" id="loginName" placeholder="ê¹€ì”¨ë„¤ ê°€ì¡±" class="w-full px-4 py-3 border border-gray-300 rounded-lg text-base">
                                            </div>
                                            <div>
                                                <label class="block text-sm font-medium text-gray-700 mb-1">ì „í™”ë²ˆí˜¸</label>
                                                <input type="tel" id="loginPhone" placeholder="01012345678" class="w-full px-4 py-3 border border-gray-300 rounded-lg text-base">
                                            </div>
                                            <button onclick="handleLogin()" class="w-full py-3 bg-blue-600 text-white rounded-lg font-bold active:bg-blue-700">
                                                ë¡œê·¸ì¸
                                            </button>
                                            <button onclick="openAuthModal('signup')" class="w-full py-3 border border-gray-300 text-gray-700 rounded-lg active:bg-gray-50">
                                                íšŒì›ê°€ì…ìœ¼ë¡œ ì „í™˜
                                            </button>
                                        </div>
                                    `}
                                </div>
                            </div>
                        ` : ''}
                    `;
                    return;
                }

                // ìƒì„¸ í˜ì´ì§€
                if (showDetailPage && selectedDate) {
                    const dateSchedules = getSchedulesForDate(selectedDate);
                    const camping = getCampingForDate(selectedDate);
                    const dateNotes = getNotesForDate(selectedDate);
                    const dateObj = new Date(selectedDate + 'T00:00:00');
                    
                    const attendingUsers = [];
                    for (let i = 0; i < users.length; i++) {
                        const schedule = getUserSchedule(dateSchedules, users[i].id);
                        if (schedule && schedule.title === 'ì°¸ì—¬') {
                            attendingUsers.push(users[i]);
                        }
                    }

                    app.innerHTML = `
                        <div class="min-h-screen bg-gray-50">
                            <div class="sticky top-0 z-10 bg-green-600 text-white shadow-lg">
                                <div class="p-4 flex items-center gap-3">
                                    <button onclick="closeDetailPage()" class="text-2xl">â†</button>
                                    <div class="flex-1">
                                        <h2 class="text-xl font-bold">${formatDateKo(dateObj)}</h2>
                                    </div>
                                </div>
                            </div>

                            <div class="p-4 space-y-4">
                                <!-- ìº í•‘ì¥ ì •ë³´ -->
                                <div class="bg-white rounded-lg p-4 shadow">
                                    <h3 class="font-bold text-lg mb-3 flex items-center gap-2">
                                        ğŸ•ï¸ ìº í•‘ì¥ ì •ë³´
                                    </h3>
                                    ${camping ? `
                                        <div class="space-y-2">
                                            <div class="font-bold text-xl text-green-700">${camping.name}</div>
                                            ${camping.address ? '<div class="text-sm text-gray-600">ğŸ“ ' + camping.address + '</div>' : ''}
                                            ${camping.website ? '<a href="' + camping.website + '" target="_blank" class="text-sm text-blue-600 underline block">ğŸ”— ì›¹ì‚¬ì´íŠ¸ ë°”ë¡œê°€ê¸°</a>' : ''}
                                            <div class="text-xs text-gray-400 mt-2">ë“±ë¡: ${camping.createdByName}</div>
                                        </div>
                                    ` : '<div class="text-gray-400 text-center py-4">ë“±ë¡ëœ ìº í•‘ì¥ì´ ì—†ìŠµë‹ˆë‹¤</div>'}
                                </div>

                                <!-- ì°¸ì—¬ ê°€ì¡±ë³„ ë©”ëª¨ -->
                                <div class="bg-white rounded-lg p-4 shadow">
                                    <h3 class="font-bold text-lg mb-3">ğŸ“ ê°€ì¡±ë³„ ì¤€ë¹„ì‚¬í•­</h3>
                                    ${attendingUsers.length > 0 ? `
                                        <div class="space-y-4">
                                            ${attendingUsers.map(function(user) {
                                                const userNotes = dateNotes.filter(function(n) { return n.userId === user.id; });
                                                const color = familyColors[user.colorIndex];
                                                return `
                                                    <div class="border-l-4 pl-3" style="border-color: ${color}">
                                                        <div class="font-bold text-gray-800 mb-2">${user.name}</div>
                                                        <div class="space-y-2 mb-3">
                                                            ${userNotes.map(function(note) {
                                                                return `
                                                                    <div class="flex items-start gap-2 group">
                                                                        <span class="text-lg" style="color: ${color}">â€¢</span>
                                                                        <div class="flex-1 text-sm text-gray-700">${note.content}</div>
                                                                        ${note.userId === currentUser.id ? `
                                                                            <button onclick="deleteNote('${note.id}', '${note.userId}')" class="opacity-0 group-hover:opacity-100 text-red-600 text-xs px-2">ì‚­ì œ</button>
                                                                        ` : ''}
                                                                    </div>
                                                                `;
                                                            }).join('')}
                                                        </div>
                                                        ${user.id === currentUser.id ? `
                                                            <div class="flex gap-2">
                                                                <input type="text" id="noteInput-${user.id}" placeholder="ì¤€ë¹„í•  ê²ƒì„ ì…ë ¥í•˜ì„¸ìš”" class="flex-1 px-3 py-2 border border-gray-300 rounded-lg text-sm" onkeypress="if(event.key==='Enter') addNote('${user.id}')">
                                                                <button onclick="addNote('${user.id}')" class="px-4 py-2 bg-green-600 text-white rounded-lg text-sm font-medium active:bg-green-700">
                                                                    ì¶”ê°€
                                                                </button>
                                                            </div>
                                                        ` : ''}
                                                    </div>
                                                `;
                                            }).join('')}
                                        </div>
                                    ` : '<div class="text-gray-400 text-center py-4">ì°¸ì—¬ í™•ì •ëœ ê°€ì¡±ì´ ì—†ìŠµë‹ˆë‹¤</div>'}
                                </div>
                            </div>
                        </div>
                    `;
                    return;
                }

                // ë©”ì¸ í™”ë©´
                const dates = getNext30Days();
                const today = new Date();
                const todayStr = formatDate(today);

                let datesHtml = '';
                for (let i = 0; i < dates.length; i++) {
                    const date = dates[i];
                    const dateStr = formatDate(date);
                    const isToday = dateStr === todayStr;
                    const dateSchedules = getSchedulesForDate(dateStr);
                    const camping = getCampingForDate(dateStr);
                    const dateColor = getDateColor(date);
                    const isSunday = date.getDay() === 0;
                    const isSaturday = date.getDay() === 6;

                    let membersStatusHtml = '<div class="grid grid-cols-3 gap-1 mt-2">';
                    let attendingCount = 0;
                    
                    for (let j = 0; j < 3; j++) {
                        if (j < users.length) {
                            const user = users[j];
                            const status = getUserSchedule(dateSchedules, user.id);
                            const color = familyColors[user.colorIndex];
                            
                            if (status) {
                                if (status.title === 'ì°¸ì—¬') attendingCount++;
                                const emoji = status.title === 'ì°¸ì—¬' ? 'âœ“' : status.title === 'ë¶ˆì°¸' ? 'âœ—' : '?';
                                membersStatusHtml += `
                                    <div class="text-center py-2 rounded text-white text-sm font-bold" style="background-color: ${color}">
                                        <div>${emoji}</div>
                                        <div class="text-xs mt-1 truncate px-1">${user.name}</div>
                                    </div>
                                `;
                            } else {
                                membersStatusHtml += `
                                    <div class="text-center py-2 rounded bg-gray-200 text-gray-400 text-sm">
                                        <div>?</div>
                                        <div class="text-xs mt-1 truncate px-1">${user.name}</div>
                                    </div>
                                `;
                            }
                        } else {
                            membersStatusHtml += `
                                <div class="text-center py-2 rounded bg-gray-100 text-gray-300 text-xs">
                                    ë¹ˆìë¦¬
                                </div>
                            `;
                        }
                    }
                    membersStatusHtml += '</div>';

                    let statusSummary = '';
                    if (attendingCount === users.length && users.length > 0) {
                        statusSummary = '<div class="mt-2 text-center text-sm font-bold text-green-600">âœ“ ëª¨ë‘ ì°¸ì—¬!</div>';
                    } else if (attendingCount > 0) {
                        statusSummary = `<div class="mt-2 text-center text-sm text-gray-600">${attendingCount}ê°€ì¡± ì°¸ì—¬</div>`;
                    }

                    datesHtml += `
                        <div class="bg-white rounded-lg p-4 shadow-sm border-2 ${isToday ? 'border-green-500' : isSunday ? 'border-red-200' : isSaturday ? 'border-blue-200' : 'border-gray-200'}">
                            <div class="flex items-center justify-between mb-2">
                                <div class="flex-1" onclick="openDetailPage('${dateStr}')">
                                    <div class="font-bold text-lg ${isToday ? 'text-green-600' : dateColor}">
                                        ${formatDateKo(date)}
                                    </div>
                                    ${camping ? `<div class="text-sm text-green-700 font-semibold mt-1" onclick="event.stopPropagation(); openCampingModal('${dateStr}', ${JSON.stringify(camping).replace(/"/g, '&quot;')})">ğŸ•ï¸ ${camping.name}</div>` : ''}
                                </div>
                                <div class="flex gap-1">
                                    ${!camping || camping.createdBy === currentUser.id ? `
                                        <button onclick="openCampingModal('${dateStr}', ${camping ? JSON.stringify(camping).replace(/"/g, '&quot;') : 'null'})" class="text-xs bg-green-100 text-green-700 px-2 py-1 rounded font-medium">
                                            ${camping ? 'ìˆ˜ì •' : 'ë“±ë¡'}
                                        </button>
                                    ` : ''}
                                    <button onclick="openAddModal('${dateStr}')" class="text-blue-600 font-bold text-xl px-2">
                                        +
                                    </button>
                                </div>
                            </div>
                            ${membersStatusHtml}
                            ${statusSummary