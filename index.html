<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="mobile-web-app-capable" content="yes">
    <title>ê°™ì´ ë†€ëŸ¬ê°€ì</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        * { -webkit-tap-highlight-color: transparent; }
        body { overscroll-behavior: none; }
        @keyframes bounce { 0%, 100% { transform: translateY(0); } 50% { transform: translateY(-10px); } }
        .animate-bounce { animation: bounce 1.5s infinite; }
    </style>
</head>
<body class="bg-gray-50">
    <div id="app">
        <div class="fixed inset-0 bg-gradient-to-b from-indigo-600 via-purple-600 to-pink-500 flex flex-col items-center justify-center">
            <div class="text-center">
                <div class="text-8xl mb-6 animate-pulse">â›º</div>
                <div class="flex items-end justify-center gap-4 mb-6">
                    <div class="text-4xl animate-bounce" style="animation-delay: 0s">ğŸ§</div>
                    <div class="text-6xl">ğŸ”¥</div>
                    <div class="text-4xl animate-bounce" style="animation-delay: 0.3s">ğŸ§</div>
                </div>
                <h2 class="text-3xl font-bold text-white mb-2">ê°™ì´ ë†€ëŸ¬ê°€ì</h2>
                <p class="text-white/80 text-sm">ë¡œë”© ì¤‘...</p>
            </div>
        </div>
    </div>

    <script src="https://unpkg.com/firebase@8.10.1/firebase-app.js"></script>
    <script src="https://unpkg.com/firebase@8.10.1/firebase-firestore.js"></script>
    
    <script>
         console.log("=== ì•± ì‹œì‘ ===");
        
        if (typeof firebase === 'undefined') {
            var checkCount = 0;
            var checkTimer = setInterval(function() {
                checkCount++;
                if (typeof firebase !== 'undefined') {
                    clearInterval(checkTimer);
                    startApp();
                } else if (checkCount >= 30) {
                    clearInterval(checkTimer);
                    document.getElementById('app').innerHTML = '<div class="min-h-screen flex items-center justify-center p-6"><div class="text-center"><h2 class="text-2xl font-bold text-red-600 mb-4">ì—°ê²° ì‹¤íŒ¨</h2><p class="text-gray-600 mb-4">Firebase ì—°ê²°ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.</p><button onclick="location.reload()" class="px-6 py-3 bg-blue-600 text-white rounded-lg font-bold">ë‹¤ì‹œ ì‹œë„</button></div></div>';
                }
            }, 100);
        } else {
            startApp();
        }
        
        function startApp() {
            var firebaseConfig = {
                apiKey: "AIzaSyAu15qibhSy3rBEUYXOxRCqoBf-BlpLtJg",
                authDomain: "camp-4cd5d.firebaseapp.com",
                projectId: "camp-4cd5d",
                storageBucket: "camp-4cd5d.firebasestorage.app",
                messagingSenderId: "322221151055",
                appId: "1:322221151055:web:bf81c9f9310b4daf4f6b3a"
            };

            firebase.initializeApp(firebaseConfig);
            var db = firebase.firestore();
            
            var users = [];
            var schedules = [];
            var campings = [];
            var notes = [];
            var currentUser = JSON.parse(localStorage.getItem('campingUser') || 'null');
            var showLoading = !!currentUser;
            var selectedDate = null;
            var showModal = false;
            var showAuthModal = false;
            var showCampingModal = false;
            var showDetailPage = false;
            var authMode = 'login';
            var editingCamping = null;
            var currentMonth = new Date();

            var familyColors = { 0: '#3b82f6', 1: '#ef4444', 2: '#10b981' };

            // 2025ë…„ ëŒ€í•œë¯¼êµ­ ê³µíœ´ì¼
            var holidays = {
                '2025-01-01': 'ì‹ ì •',
                '2025-01-28': 'ì„¤ë‚  ì—°íœ´',
                '2025-01-29': 'ì„¤ë‚ ',
                '2025-01-30': 'ì„¤ë‚  ì—°íœ´',
                '2025-03-01': 'ì‚¼ì¼ì ˆ',
                '2025-05-05': 'ì–´ë¦°ì´ë‚ ',
                '2025-05-06': 'ëŒ€ì²´ê³µíœ´ì¼',
                '2025-06-06': 'í˜„ì¶©ì¼',
                '2025-08-15': 'ê´‘ë³µì ˆ',
                '2025-10-03': 'ê°œì²œì ˆ',
                '2025-10-05': 'ì¶”ì„ ì—°íœ´',
                '2025-10-06': 'ì¶”ì„',
                '2025-10-07': 'ì¶”ì„ ì—°íœ´',
                '2025-10-08': 'ëŒ€ì²´ê³µíœ´ì¼',
                '2025-10-09': 'í•œê¸€ë‚ ',
                '2025-12-25': 'í¬ë¦¬ìŠ¤ë§ˆìŠ¤'
            };

            function getHoliday(dateStr) {
                return holidays[dateStr] || null;
            }

            window.changeMonth = function(direction) {
                currentMonth = new Date(currentMonth.getFullYear(), currentMonth.getMonth() + direction, 1);
                render();
            };

            db.collection('users').onSnapshot(function(s) {
                users = [];
                s.forEach(function(d) { 
                    var data = d.data();
                    users.push({id: d.id, name: data.name, phone: data.phone, colorIndex: data.colorIndex, createdAt: data.createdAt}); 
                });
                render();
            });

            db.collection('schedules').onSnapshot(function(s) {
                schedules = [];
                s.forEach(function(d) { 
                    var data = d.data();
                    schedules.push({id: d.id, title: data.title, date: data.date, userId: data.userId, userName: data.userName, color: data.color}); 
                });
                render();
            });

            db.collection('campings').onSnapshot(function(s) {
                campings = [];
                s.forEach(function(d) { 
                    var data = d.data();
                    campings.push({id: d.id, name: data.name, address: data.address, website: data.website, info: data.info, startDate: data.startDate, endDate: data.endDate, createdBy: data.createdBy, createdByName: data.createdByName}); 
                });
                render();
            });

            db.collection('notes').onSnapshot(function(s) {
                notes = [];
                s.forEach(function(d) { 
                    var data = d.data();
                    notes.push({id: d.id, date: data.date, userId: data.userId, content: data.content, createdAt: data.createdAt}); 
                });
                render();
            });

            if (showLoading) {
                setTimeout(function() { showLoading = false; render(); }, 2000);
            }

            function getNext30Days() {
                var year = currentMonth.getFullYear();
                var month = currentMonth.getMonth();
                var dates = [];
                var lastDay = new Date(year, month + 1, 0);
                var daysInMonth = lastDay.getDate();
                
                for (var i = 1; i <= daysInMonth; i++) {
                    dates.push(new Date(year, month, i));
                }
                return dates;
            }

            function getMonthYear() {
                return currentMonth.getFullYear() + 'ë…„ ' + (currentMonth.getMonth() + 1) + 'ì›”';
            }

            function formatDate(d) {
                return d.getFullYear() + '-' + String(d.getMonth() + 1).padStart(2, '0') + '-' + String(d.getDate()).padStart(2, '0');
            }

            function formatDateKo(d) {
                var days = ['ì¼', 'ì›”', 'í™”', 'ìˆ˜', 'ëª©', 'ê¸ˆ', 'í† '];
                return (d.getMonth() + 1) + '/' + d.getDate() + ' (' + days[d.getDay()] + ')';
            }

            function getDateColor(d) {
                var day = d.getDay();
                return day === 0 ? 'text-red-600' : day === 6 ? 'text-blue-600' : 'text-gray-800';
            }

            window.openAuthModal = function(mode) {
                authMode = mode;
                showAuthModal = true;
                render();
            };

            window.closeAuthModal = function() {
                showAuthModal = false;
                render();
            };

            window.handleSignup = function() {
                var name = document.getElementById('signupName').value.trim();
                var phone = document.getElementById('signupPhone').value.trim();
                if (!name || !phone) return alert('ì…ë ¥í•´ì£¼ì„¸ìš”');
                
                var phoneExists = false;
                for (var i = 0; i < users.length; i++) {
                    if (users[i].phone === phone) phoneExists = true;
                }
                if (phoneExists) return alert('ì´ë¯¸ ê°€ì…ë¨');
                if (users.length >= 3) return alert('ì •ì› ë§ˆê°');
                
                db.collection('users').add({
                    name: name, phone: phone, colorIndex: users.length, createdAt: new Date().toISOString()
                }).then(function(ref) {
                    currentUser = {id: ref.id, name: name, phone: phone, colorIndex: users.length};
                    localStorage.setItem('campingUser', JSON.stringify(currentUser));
                    showLoading = true;
                    showAuthModal = false;
                    render();
                    setTimeout(function() { showLoading = false; render(); }, 2000);
                });
            };

            window.handleLogin = function() {
                var name = document.getElementById('loginName').value.trim();
                var phone = document.getElementById('loginPhone').value.trim();
                if (!name || !phone) return alert('ì…ë ¥í•´ì£¼ì„¸ìš”');
                
                var found = null;
                for (var i = 0; i < users.length; i++) {
                    if (users[i].name === name && users[i].phone === phone) found = users[i];
                }
                
                if (found) {
                    currentUser = found;
                    localStorage.setItem('campingUser', JSON.stringify(currentUser));
                    showLoading = true;
                    showAuthModal = false;
                    render();
                    setTimeout(function() { showLoading = false; render(); }, 2000);
                } else {
                    alert('íšŒì› ì •ë³´ ì—†ìŒ');
                }
            };

            window.logout = function() {
                if (confirm('ë¡œê·¸ì•„ì›ƒí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
                    currentUser = null;
                    localStorage.removeItem('campingUser');
                    render();
                }
            };

            window.openAddModal = function(dateStr) {
                if (!currentUser) return openAuthModal('login');
                selectedDate = dateStr;
                showModal = true;
                render();
            };

            window.closeModal = function() {
                showModal = false;
                selectedDate = null;
                render();
            };

            window.openCampingModal = function(dateStr, campingId) {
                if (!currentUser) return alert('ë¡œê·¸ì¸ í•„ìš”');
                selectedDate = dateStr;
                if (campingId) {
                    for (var i = 0; i < campings.length; i++) {
                        if (campings[i].id === campingId) editingCamping = campings[i];
                    }
                } else {
                    editingCamping = null;
                }
                showCampingModal = true;
                render();
            };

            window.closeCampingModal = function() {
                showCampingModal = false;
                editingCamping = null;
                render();
            };

            window.saveCamping = function() {
                var name = document.getElementById('campingName').value.trim();
                var address = document.getElementById('campingAddress').value.trim();
                var website = document.getElementById('campingWebsite').value.trim();
                var info = document.getElementById('campingInfo').value.trim();
                var startDate = document.getElementById('campingStartDate').value;
                var endDate = document.getElementById('campingEndDate').value;
                
                if (!name) return alert('ì´ë¦„ í•„ìˆ˜');
                if (!startDate) return alert('ì‹œì‘ì¼ì„ ì„ íƒí•´ì£¼ì„¸ìš”');
                if (!endDate) return alert('ì¢…ë£Œì¼ì„ ì„ íƒí•´ì£¼ì„¸ìš”');
                if (new Date(endDate) < new Date(startDate)) return alert('ì¢…ë£Œì¼ì€ ì‹œì‘ì¼ ì´í›„ì—¬ì•¼ í•©ë‹ˆë‹¤');

                var data = {
                    name: name, 
                    address: address, 
                    website: website, 
                    info: info,
                    startDate: startDate,
                    endDate: endDate,
                    createdBy: currentUser.id, 
                    createdByName: currentUser.name
                };

                if (editingCamping) {
                    if (editingCamping.createdBy !== currentUser.id) return alert('ê¶Œí•œ ì—†ìŒ');
                    db.collection('campings').doc(editingCamping.id).update(data).then(function() {
                        showCampingModal = false;
                        editingCamping = null;
                        render();
                    });
                } else {
                    db.collection('campings').add(data).then(function() {
                        showCampingModal = false;
                        render();
                    });
                }
            };

            window.deleteCamping = function(id, createdBy) {
                if (createdBy !== currentUser.id) return alert('ê¶Œí•œ ì—†ìŒ');
                if (confirm('ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
                    db.collection('campings').doc(id).delete().then(function() {
                        if (showDetailPage) {
                            showDetailPage = false;
                            selectedDate = null;
                        } else {
                            showCampingModal = false;
                            editingCamping = null;
                        }
                        render();
                    });
                }
            };

            function getCampingForDateRange(dateStr) {
                for (var i = 0; i < campings.length; i++) {
                    if (dateStr >= campings[i].startDate && dateStr <= campings[i].endDate) {
                        return campings[i];
                    }
                }
                return null;
            }

            function isFirstDayOfCamping(dateStr, camping) {
                return camping && dateStr === camping.startDate;
            }

            function getDayCount(camping) {
                var start = new Date(camping.startDate);
                var end = new Date(camping.endDate);
                var diff = (end - start) / (1000 * 60 * 60 * 24);
                return diff + 1;
            }

            window.setStatus = function(status) {
                if (!currentUser || !selectedDate) return;
                
                var camping = getCampingForDateRange(selectedDate);
                var datesToUpdate = [];
                
                if (camping) {
                    var start = new Date(camping.startDate);
                    var end = new Date(camping.endDate);
                    for (var d = new Date(start); d <= end; d.setDate(d.getDate() + 1)) {
                        datesToUpdate.push(formatDate(new Date(d)));
                    }
                } else {
                    datesToUpdate.push(selectedDate);
                }
                
                var updatePromises = [];
                for (var i = 0; i < datesToUpdate.length; i++) {
                    var dateStr = datesToUpdate[i];
                    var existing = null;
                    for (var j = 0; j < schedules.length; j++) {
                        if (schedules[j].date === dateStr && schedules[j].userId === currentUser.id) {
                            existing = schedules[j];
                            break;
                        }
                    }
                    
                    var data = {
                        title: status, 
                        date: dateStr, 
                        userId: currentUser.id,
                        userName: currentUser.name, 
                        color: familyColors[currentUser.colorIndex]
                    };

                    if (existing) {
                        updatePromises.push(db.collection('schedules').doc(existing.id).update(data));
                    } else {
                        updatePromises.push(db.collection('schedules').add(data));
                    }
                }
                
                Promise.all(updatePromises).then(function() {
                    showModal = false;
                    selectedDate = null;
                    render();
                });
            };

            window.deleteStatus = function(id) {
                if (confirm('ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) db.collection('schedules').doc(id).delete();
            };

            window.openDetailPage = function(dateStr) {
                selectedDate = dateStr;
                showDetailPage = true;
                render();
            };

            window.closeDetailPage = function() {
                showDetailPage = false;
                selectedDate = null;
                render();
            };

            window.addNote = function(userId) {
                var input = document.getElementById('noteInput-' + userId);
                var content = input.value.trim();
                if (!content) return;

                db.collection('notes').add({
                    date: selectedDate, 
                    userId: userId, 
                    content: content, 
                    createdAt: new Date().toISOString()
                }).then(function() { 
                    input.value = ''; 
                });
            };

            window.deleteNote = function(id, userId) {
                if (userId !== currentUser.id) return alert('ê¶Œí•œ ì—†ìŒ');
                if (confirm('ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) db.collection('notes').doc(id).delete();
            };

            function escapeHtml(text) {
                var div = document.createElement('div');
                div.textContent = text;
                return div.innerHTML;
            }
            function render() {
                var app = document.getElementById('app');

                if (showLoading) {
                    app.innerHTML = '<div class="fixed inset-0 bg-gradient-to-b from-indigo-600 via-purple-600 to-pink-500 flex items-center justify-center"><div class="text-center"><div class="text-9xl mb-6 animate-pulse">â›º</div><div class="flex items-end justify-center gap-6 mb-8"><div class="text-5xl animate-bounce">ğŸ§</div><div class="text-7xl">ğŸ”¥</div><div class="text-5xl animate-bounce" style="animation-delay:0.3s">ğŸ§</div></div><h2 class="text-3xl font-bold text-white">ê°™ì´ ë†€ëŸ¬ê°€ì</h2></div></div>';
                    return;
                }

                if (!currentUser) {
                    app.innerHTML = '<div class="min-h-screen flex flex-col items-center justify-center p-6 bg-gradient-to-b from-green-400 to-blue-400"><div class="text-center mb-8"><h1 class="text-6xl mb-4">ğŸ•ï¸</h1><h2 class="text-3xl font-bold text-white mb-2">ìº í•‘ ìŠ¤ì¼€ì¤„</h2><p class="text-white/90">ê°€ì¡±ë“¤ê³¼ ìº í•‘ ì¼ì •ì„ ê³µìœ í•˜ì„¸ìš”</p></div><div class="w-full max-w-sm space-y-3"><button onclick="openAuthModal(\'login\')" class="w-full py-4 bg-white text-green-700 rounded-lg font-bold text-lg shadow-lg">ë¡œê·¸ì¸</button><button onclick="openAuthModal(\'signup\')" class="w-full py-4 bg-green-600 text-white rounded-lg font-bold text-lg shadow-lg">íšŒì›ê°€ì…</button></div><div class="mt-8 text-sm text-white"><p>í˜„ì¬: ' + users.length + '/3 ê°€ì¡±</p></div></div>' + (showAuthModal ? '<div class="fixed inset-0 bg-black/50 z-50 flex items-center justify-center p-4" onclick="if(event.target===this)closeAuthModal()"><div class="bg-white w-full max-w-sm rounded-2xl p-6"><h3 class="text-2xl font-bold mb-6 text-center">' + (authMode === 'login' ? 'ë¡œê·¸ì¸' : 'íšŒì›ê°€ì…') + '</h3>' + (authMode === 'signup' ? '<div class="space-y-4"><div><label class="block text-sm font-medium mb-1">ê°€ì¡±ëª…</label><input type="text" id="signupName" placeholder="ê¹€ì”¨ë„¤" class="w-full px-4 py-3 border rounded-lg"></div><div><label class="block text-sm font-medium mb-1">ì „í™”ë²ˆí˜¸</label><input type="tel" id="signupPhone" placeholder="01012345678" class="w-full px-4 py-3 border rounded-lg"></div><button onclick="handleSignup()" class="w-full py-3 bg-green-600 text-white rounded-lg font-bold">ê°€ì…</button><button onclick="openAuthModal(\'login\')" class="w-full py-3 border rounded-lg">ë¡œê·¸ì¸ìœ¼ë¡œ</button></div>' : '<div class="space-y-4"><div><label class="block text-sm font-medium mb-1">ê°€ì¡±ëª…</label><input type="text" id="loginName" placeholder="ê¹€ì”¨ë„¤" class="w-full px-4 py-3 border rounded-lg"></div><div><label class="block text-sm font-medium mb-1">ì „í™”ë²ˆí˜¸</label><input type="tel" id="loginPhone" placeholder="01012345678" class="w-full px-4 py-3 border rounded-lg"></div><button onclick="handleLogin()" class="w-full py-3 bg-blue-600 text-white rounded-lg font-bold">ë¡œê·¸ì¸</button><button onclick="openAuthModal(\'signup\')" class="w-full py-3 border rounded-lg">íšŒì›ê°€ì…ìœ¼ë¡œ</button></div>') + '</div></div>' : '');
                    return;
                }
                  if (showDetailPage && selectedDate) {
                    var dateSchedules = [];
                    for (var i = 0; i < schedules.length; i++) {
                        if (schedules[i].date === selectedDate) dateSchedules.push(schedules[i]);
                    }
                    
                    var camping = getCampingForDateRange(selectedDate);
                    
                    var dateNotes = [];
                    for (var i = 0; i < notes.length; i++) {
                        if (notes[i].date === selectedDate) dateNotes.push(notes[i]);
                    }
                    
                    var dateObj = new Date(selectedDate + 'T00:00:00');
                    
                    var attendingUsers = [];
                    for (var i = 0; i < users.length; i++) {
                        var userSchedule = null;
                        for (var j = 0; j < dateSchedules.length; j++) {
                            if (dateSchedules[j].userId === users[i].id) userSchedule = dateSchedules[j];
                        }
                        if (userSchedule && userSchedule.title === 'ì°¸ì—¬') {
                            attendingUsers.push(users[i]);
                        }
                    }

                    var campingHtml = camping ? '<div><div class="flex items-center justify-between mb-2"><div class="font-bold text-xl text-green-700">' + escapeHtml(camping.name) + '</div>' + (isFirstDayOfCamping(selectedDate, camping) ? '<span class="text-xs bg-green-100 text-green-700 px-2 py-1 rounded">' + getDayCount(camping) + 'ì¼</span>' : '<span class="text-xs bg-gray-100 text-gray-600 px-2 py-1 rounded">ì§„í–‰ì¤‘</span>') + '</div><div class="text-sm text-gray-600 mb-2">ğŸ“… ' + camping.startDate + ' ~ ' + camping.endDate + '</div>' + (camping.address ? '<div class="text-sm text-gray-600 mt-2">ğŸ“ ' + escapeHtml(camping.address) + '</div>' : '') + (camping.website ? '<a href="' + escapeHtml(camping.website) + '" target="_blank" class="text-sm text-blue-600 underline block mt-2">ğŸ”— ì›¹ì‚¬ì´íŠ¸</a>' : '') + (camping.info ? '<div class="text-sm text-gray-700 mt-3 whitespace-pre-wrap border-t pt-3">' + escapeHtml(camping.info) + '</div>' : '') + '<div class="text-xs text-gray-400 mt-2">ë“±ë¡: ' + escapeHtml(camping.createdByName) + '</div>' + (camping.createdBy === currentUser.id ? '<div class="mt-3 flex gap-2"><button onclick="openCampingModal(\'' + selectedDate + '\', \'' + camping.id + '\')" class="px-4 py-2 bg-blue-600 text-white rounded-lg text-sm">ìˆ˜ì •</button><button onclick="deleteCamping(\'' + camping.id + '\', \'' + camping.createdBy + '\')" class="px-4 py-2 bg-red-600 text-white rounded-lg text-sm">ì‚­ì œ</button></div>' : '') + '</div>' : '<div class="text-gray-400 text-center py-4">ë“±ë¡ëœ ìº í•‘ì¥ ì—†ìŒ</div>';

                    var notesHtml = '';
                    if (attendingUsers.length > 0) {
                        notesHtml = '<div class="space-y-4">';
                        for (var i = 0; i < attendingUsers.length; i++) {
                            var u = attendingUsers[i];
                            var userNotes = [];
                            for (var j = 0; j < dateNotes.length; j++) {
                                if (dateNotes[j].userId === u.id) userNotes.push(dateNotes[j]);
                            }
                            var color = familyColors[u.colorIndex];
                            
                            notesHtml += '<div class="border-l-4 pl-3" style="border-color:' + color + '"><div class="font-bold mb-2">' + escapeHtml(u.name) + '</div><div class="space-y-2 mb-3">';
                            
                            for (var j = 0; j < userNotes.length; j++) {
                                var n = userNotes[j];
                                notesHtml += '<div class="flex items-start gap-2 group"><span style="color:' + color + '">â€¢</span><div class="flex-1 text-sm whitespace-pre-wrap">' + escapeHtml(n.content) + '</div>' + (n.userId === currentUser.id ? '<button onclick="deleteNote(\'' + n.id + '\',\'' + n.userId + '\')" class="text-red-600 text-xs px-2 opacity-0 group-hover:opacity-100">ì‚­ì œ</button>' : '') + '</div>';
                            }
                            
                            notesHtml += '</div>' + (u.id === currentUser.id ? '<div class="flex flex-col gap-2"><textarea id="noteInput-' + u.id + '" placeholder="ì¤€ë¹„í•  ê²ƒì„ ììœ ë¡­ê²Œ ì‘ì„±í•˜ì„¸ìš” (ìµœëŒ€ 2000ì)" maxlength="2000" class="w-full px-3 py-2 border rounded-lg text-sm resize-none" rows="4"></textarea><button onclick="addNote(\'' + u.id + '\')" class="w-full py-2 bg-green-600 text-white rounded-lg text-sm font-medium">ì¶”ê°€</button></div>' : '') + '</div>';
                        }
                        notesHtml += '</div>';
                    } else {
                        notesHtml = '<div class="text-gray-400 text-center py-4">ì°¸ì—¬ ê°€ì¡± ì—†ìŒ</div>';
                    }

                    app.innerHTML = '<div class="min-h-screen bg-gray-50"><div class="sticky top-0 z-0 bg-green-600 text-white shadow-lg p-4 flex items-center gap-3"><button onclick="closeDetailPage()" class="text-2xl">â†</button><h2 class="text-xl font-bold">' + formatDateKo(dateObj) + '</h2></div><div class="p-4 space-y-4"><div class="bg-white rounded-lg p-4 shadow"><h3 class="font-bold text-lg mb-3">ğŸ•ï¸ ìº í•‘ì¥ ì •ë³´</h3>' + campingHtml + '</div><div class="bg-white rounded-lg p-4 shadow"><h3 class="font-bold text-lg mb-3">ğŸ“ ì¤€ë¹„ì‚¬í•­</h3>' + notesHtml + '</div></div></div>';
                    return;
                }
                 var dates = getNext30Days();
                var today = new Date();
                var todayStr = formatDate(today);
                var myColor = familyColors[currentUser.colorIndex];

                var datesHtml = '';
                for (var i = 0; i < dates.length; i++) {
                    var date = dates[i];
                    var dateStr = formatDate(date);
                    var isToday = dateStr === todayStr;
                    var holiday = getHoliday(dateStr);
                    
                    var dateSchedules = [];
                    for (var j = 0; j < schedules.length; j++) {
                        if (schedules[j].date === dateStr) dateSchedules.push(schedules[j]);
                    }
                    
                    var camping = getCampingForDateRange(dateStr);
                    var isFirstDay = isFirstDayOfCamping(dateStr, camping);
                    var dateColor = getDateColor(date);
                    var isSunday = date.getDay() === 0;
                    var isSaturday = date.getDay() === 6;
                    var attendingCount = 0;

                    var membersHtml = '<div class="grid grid-cols-3 gap-1 mt-2">';
                    for (var j = 0; j < 3; j++) {
                        if (j < users.length) {
                            var user = users[j];
                            var status = null;
                            for (var k = 0; k < dateSchedules.length; k++) {
                                if (dateSchedules[k].userId === user.id) status = dateSchedules[k];
                            }
                            var color = familyColors[user.colorIndex];
                            if (status) {
                                if (status.title === 'ì°¸ì—¬') attendingCount++;
                                var emoji = status.title === 'ì°¸ì—¬' ? 'âœ“' : status.title === 'ë¶ˆì°¸' ? 'âœ—' : '?';
                                membersHtml += '<div class="text-center py-2 rounded text-white text-sm font-bold" style="background-color:' + color + '"><div>' + emoji + '</div><div class="text-xs mt-1 truncate px-1">' + escapeHtml(user.name) + '</div></div>';
                            } else {
                                membersHtml += '<div class="text-center py-2 rounded bg-gray-200 text-gray-400 text-sm"><div>?</div><div class="text-xs mt-1 truncate px-1">' + escapeHtml(user.name) + '</div></div>';
                            }
                        } else {
                            membersHtml += '<div class="text-center py-2 rounded bg-gray-100 text-gray-300 text-xs">ë¹ˆìë¦¬</div>';
                        }
                    }
                    membersHtml += '</div>';

                    var summary = '';
                    if (attendingCount === users.length && users.length > 0) {
                        summary = '<div class="mt-2 text-center text-sm font-bold text-green-600">âœ“ ëª¨ë‘ ì°¸ì—¬!</div>';
                    } else if (attendingCount > 0) {
                        summary = '<div class="mt-2 text-center text-sm text-gray-600">' + attendingCount + 'ê°€ì¡± ì°¸ì—¬</div>';
                    }

                    datesHtml += '<div class="bg-white rounded-lg p-4 shadow-sm border-2 ' + (isToday ? 'border-green-500' : holiday ? 'border-red-300' : isSunday ? 'border-red-200' : isSaturday ? 'border-blue-200' : camping ? 'border-green-300' : 'border-gray-200') + (camping && !isFirstDay ? ' bg-green-50' : holiday ? ' bg-red-50' : '') + '"><div class="flex items-center justify-between mb-2"><div class="flex-1" onclick="openDetailPage(\'' + dateStr + '\')"><div class="font-bold text-lg ' + (isToday ? 'text-green-600' : holiday ? 'text-red-600' : dateColor) + '">' + formatDateKo(date) + (holiday ? ' ğŸ‰' : '') + '</div>' + (holiday ? '<div class="text-xs text-red-600 font-semibold">' + holiday + '</div>' : '') + (camping && isFirstDay ? '<div class="text-sm text-green-700 font-semibold mt-1">ğŸ•ï¸ ' + escapeHtml(camping.name) + ' (' + getDayCount(camping) + 'ì¼)</div>' : camping ? '<div class="text-sm text-green-600 mt-1">ğŸ•ï¸ ' + escapeHtml(camping.name) + ' (ì§„í–‰ì¤‘)</div>' : '') + '</div><div class="flex gap-1">' + (isFirstDay || !camping ? '<button onclick="event.stopPropagation(); openCampingModal(\'' + dateStr + '\', ' + (camping ? '\'' + camping.id + '\'' : 'null') + ')" class="text-xs bg-green-100 text-green-700 px-2 py-1 rounded">' + (camping ? 'ìˆ˜ì •' : 'ë“±ë¡') + '</button>' : '') + '<button onclick="openAddModal(\'' + dateStr + '\')" class="text-blue-600 font-bold text-xl px-2">+</button></div></div>' + membersHtml + summary + '</div>';
                }
                  var modalHtml = '';
                if (showModal && selectedDate) {
                    var mySchedule = null;
                    for (var i = 0; i < schedules.length; i++) {
                        if (schedules[i].date === selectedDate && schedules[i].userId === currentUser.id) {
                            mySchedule = schedules[i];
                        }
                    }
                    
                    var camping = getCampingForDateRange(selectedDate);
                    var dateRangeText = '';
                    if (camping) {
                        dateRangeText = '<div class="text-xs text-green-600 bg-green-50 p-2 rounded mb-2">ğŸ•ï¸ ' + escapeHtml(camping.name) + ' ì „ì²´ ê¸°ê°„ì— ì ìš©ë©ë‹ˆë‹¤</div>';
                    }
                    
                    modalHtml = '<div class="fixed inset-0 bg-black/50 z-50 flex items-end" onclick="if(event.target===this)closeModal()"><div class="bg-white w-full rounded-t-3xl p-5"><div class="flex justify-between items-center mb-4"><h3 class="text-xl font-bold">' + formatDateKo(new Date(selectedDate + 'T00:00:00')) + '</h3><button onclick="closeModal()" class="text-3xl">Ã—</button></div><div class="space-y-4">' + dateRangeText + '<p class="text-sm mb-2">' + escapeHtml(currentUser.name) + ' ì°¸ì—¬ ì—¬ë¶€</p><div class="flex gap-2"><button onclick="setStatus(\'ì°¸ì—¬\')" class="flex-1 py-4 bg-green-600 text-white rounded-lg font-bold">âœ“ ì°¸ì—¬</button><button onclick="setStatus(\'ë¶ˆì°¸\')" class="flex-1 py-4 bg-red-600 text-white rounded-lg font-bold">âœ— ë¶ˆì°¸</button><button onclick="setStatus(\'ë³´ë¥˜\')" class="flex-1 py-4 bg-gray-600 text-white rounded-lg font-bold">? ë³´ë¥˜</button></div>' + (mySchedule ? '<div class="pt-4 border-t"><p class="text-sm text-gray-600 mb-2">í˜„ì¬ ìƒíƒœ: <span class="font-bold">' + mySchedule.title + '</span></p><button onclick="deleteStatus(\'' + mySchedule.id + '\')" class="w-full py-2 bg-red-100 text-red-700 rounded-lg font-medium">ìƒíƒœ ì‚­ì œ</button></div>' : '') + '</div></div></div>';
                }

                var campingModalHtml = '';
                if (showCampingModal) {
                    campingModalHtml = '<div class="fixed inset-0 bg-black/50 z-50 flex items-end" onclick="if(event.target===this)closeCampingModal()"><div class="bg-white w-full rounded-t-3xl p-5 max-h-[90vh] overflow-y-auto"><div class="flex justify-between items-center mb-4"><h3 class="text-xl font-bold">ğŸ•ï¸ ìº í•‘ì¥ ' + (editingCamping ? 'ìˆ˜ì •' : 'ë“±ë¡') + '</h3><button onclick="closeCampingModal()" class="text-3xl">Ã—</button></div><div class="space-y-4"><div><label class="block text-sm mb-1 font-medium">ìº í•‘ì¥ ì´ë¦„ *</label><input type="text" id="campingName" value="' + (editingCamping ? escapeHtml(editingCamping.name) : '') + '" placeholder="ë³„ë¹›ìº í•‘ì¥" class="w-full px-4 py-3 border rounded-lg"></div><div class="grid grid-cols-2 gap-2"><div><label class="block text-sm mb-1 font-medium">ì‹œì‘ì¼ *</label><input type="date" id="campingStartDate" value="' + (editingCamping ? editingCamping.startDate : selectedDate || '') + '" class="w-full px-4 py-3 border rounded-lg"></div><div><label class="block text-sm mb-1 font-medium">ì¢…ë£Œì¼ *</label><input type="date" id="campingEndDate" value="' + (editingCamping ? editingCamping.endDate : selectedDate || '') + '" class="w-full px-4 py-3 border rounded-lg"></div></div><div class="text-xs text-gray-500 bg-blue-50 p-2 rounded">ğŸ’¡ ì‹œì‘ì¼ê³¼ ì¢…ë£Œì¼ì„ ì„¤ì •í•˜ë©´ 2ë°•3ì¼, 3ë°•4ì¼ ë“±ì˜ ì¼ì •ì„ ë§Œë“¤ ìˆ˜ ìˆìŠµë‹ˆë‹¤</div><div><label class="block text-sm mb-1">ì£¼ì†Œ</label><input type="text" id="campingAddress" value="' + (editingCamping && editingCamping.address ? escapeHtml(editingCamping.address) : '') + '" placeholder="ê²½ê¸°ë„ ê°€í‰êµ°..." class="w-full px-4 py-3 border rounded-lg"></div><div><label class="block text-sm mb-1">ì›¹ì‚¬ì´íŠ¸</label><input type="url" id="campingWebsite" value="' + (editingCamping && editingCamping.website ? escapeHtml(editingCamping.website) : '') + '" placeholder="https://..." class="w-full px-4 py-3 border rounded-lg"></div><div><label class="block text-sm mb-1">ì•ˆë‚´ ë° ë©”ëª¨</label><textarea id="campingInfo" maxlength="2000" placeholder="ìº í•‘ì¥ íŠ¹ì§•, ì£¼ì˜ì‚¬í•­ ë“±ì„ ììœ ë¡­ê²Œ ì‘ì„±í•˜ì„¸ìš” (ìµœëŒ€ 2000ì)" class="w-full px-4 py-3 border rounded-lg resize-none" rows="5">' + (editingCamping && editingCamping.info ? escapeHtml(editingCamping.info) : '') + '</textarea></div><div class="flex gap-2 pt-2"><button onclick="closeCampingModal()" class="flex-1 py-3 border rounded-lg font-medium">ì·¨ì†Œ</button><button onclick="saveCamping()" class="flex-1 py-3 bg-green-600 text-white rounded-lg font-medium">ì €ì¥</button></div>' + (editingCamping && editingCamping.createdBy === currentUser.id ? '<div class="pt-4 border-t"><button onclick="deleteCamping(\'' + editingCamping.id + '\', \'' + editingCamping.createdBy + '\')" class="w-full py-2 bg-red-100 text-red-700 rounded-lg font-medium">ìº í•‘ì¥ ì •ë³´ ì‚­ì œ</button></div>' : '') + '</div></div></div>';
                }

                app.innerHTML = '<div class="min-h-screen pb-20"><div class="sticky top-0 z-10 bg-green-600 text-white shadow-lg"><div class="p-4"><div class="flex items-center justify-between mb-3"><div><h1 class="text-2xl font-bold">ğŸ•ï¸ ê°™ì´ ë†€ëŸ¬ê°€ì</h1></div><button onclick="logout()" class="text-xs bg-white/20 px-3 py-1 rounded-full">ë¡œê·¸ì•„ì›ƒ</button></div><div class="flex items-center justify-between"><button onclick="changeMonth(-1)" class="px-4 py-2 bg-white/20 rounded-lg hover:bg-white/30">â†</button><h2 class="text-xl font-bold">' + getMonthYear() + '</h2><button onclick="changeMonth(1)" class="px-4 py-2 bg-white/20 rounded-lg hover:bg-white/30">â†’</button></div><div class="mt-2 flex items-center gap-2"><div class="w-3 h-3 rounded-full" style="background-color:' + myColor + '"></div><span class="text-sm">' + escapeHtml(currentUser.name) + '</span></div></div></div><div class="p-3 space-y-3">' + datesHtml + '</div>' + modalHtml + campingModalHtml + '</div>';
            }

            render();
        }
    </script>
</body>
</html>
                
